{% extends 'base_dashboard.html' %}

{% block title %}Carrito - Plug&Ad{% endblock %}

{% block dashboard_content %}
<!-- Cart Header -->
<div class="card" style="margin-bottom: 2rem;">
  <div class="card__content">
    <div style="display: flex; justify-content: between; align-items: center; flex-wrap: wrap; gap: 1rem;">
      <div>
        <h1 style="color: var(--text-dark); margin-bottom: 0.5rem;">
          üõí Tu Carrito de Paquetes
        </h1>
        <p style="color: var(--text-muted); margin: 0;">
          Revisa y gestiona tus paquetes publicitarios seleccionados
        </p>
      </div>
      <div>
        <a href="{% url 'packages' %}" class="btn btn--secondary">
          ‚Üê Seguir Comprando
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Cart Items -->
<div class="grid grid--2" style="margin-bottom: 2rem;">
  <div>
    <div class="card">
      <div class="card__header">
        <h3 class="card__title">Productos en tu Carrito</h3>
      </div>
      <div class="card__content" id="cart-items">
        <!-- Cart items will be loaded here by JavaScript -->
      </div>
    </div>
  </div>
  
  <div>
    <div class="card">
      <div class="card__header">
        <h3 class="card__title">Resumen del Pedido</h3>
      </div>
      <div class="card__content">
        <div style="display: flex; flex-direction: column; gap: 1rem;">
          <div style="display: flex; justify-content: between;">
            <span style="color: var(--text-muted);">Subtotal:</span>
            <span style="color: var(--text-dark); font-weight: 500;" id="cart-subtotal">$0</span>
          </div>
          <div style="display: flex; justify-content: between;">
            <span style="color: var(--text-muted);">Descuento (15% por 3+):</span>
            <span style="color: #16a34a; font-weight: 500;" id="cart-discount">-$0</span>
          </div>
          <div style="border-top: 1px solid var(--border-color); padding-top: 1rem; display: flex; justify-content: between;">
            <span style="color: var(--text-dark); font-weight: 600; font-size: 1.1rem;">Total:</span>
            <span style="color: var(--primary-color); font-weight: 700; font-size: 1.2rem;" id="cart-total">$0</span>
          </div>
        </div>
        
        <div style="margin-top: 2rem;">
          <button id="checkout-btn" class="btn btn--primary btn--full btn--large" disabled>
            Proceder al Pago üí≥
          </button>
          <p style="color: var(--text-muted); font-size: 0.875rem; text-align: center; margin-top: 1rem;">
            Configuraci√≥n autom√°tica incluida ‚Ä¢ Soporte 24/7 ‚Ä¢ Sin costos ocultos
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Empty Cart Message -->
<div id="empty-cart" class="card text-center" style="display: none;">
  <div class="card__content">
    <span style="font-size: 4rem; display: block; margin-bottom: 1rem;">üõí</span>
    <h3 style="color: var(--text-dark); margin-bottom: 1rem;">Tu carrito est√° vac√≠o</h3>
    <p style="color: var(--text-muted); margin-bottom: 2rem;">
      Explora nuestros paquetes publicitarios y agrega los que m√°s te convengan
    </p>
    <a href="{% url 'packages' %}" class="btn btn--primary btn--large">
      Explorar Paquetes ‚Üí
    </a>
  </div>
</div>

<!-- Recommended Packages -->
<div id="recommendations" style="display: none;">
  <div class="card">
    <div class="card__header text-center">
      <h3 class="card__title">Tambi√©n te puede interesar</h3>
      <p class="card__description">Paquetes que combinan bien con tu selecci√≥n</p>
    </div>
    <div class="card__content">
      <div class="grid grid--3">
        <div style="text-align: center; padding: 1.5rem; border: 1px solid var(--border-color); border-radius: var(--radius-sm);">
          <span style="font-size: 2rem; display: block; margin-bottom: 1rem;">üìä</span>
          <h4 style="color: var(--primary-color); margin-bottom: 0.5rem;">Analytics Plus</h4>
          <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1rem;">
            Reportes avanzados y dashboard personalizado
          </p>
          <button onclick="addToCart('analytics-plus', 'Analytics Plus', 79)" class="btn btn--secondary btn--small">
            Agregar - $79
          </button>
        </div>
        
        <div style="text-align: center; padding: 1.5rem; border: 1px solid var(--border-color); border-radius: var(--radius-sm);">
          <span style="font-size: 2rem; display: block; margin-bottom: 1rem;">üé®</span>
          <h4 style="color: var(--primary-color); margin-bottom: 0.5rem;">Creative Studio</h4>
          <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1rem;">
            Banco de creatividades y templates premium
          </p>
          <button onclick="addToCart('creative-studio', 'Creative Studio', 59)" class="btn btn--secondary btn--small">
            Agregar - $59
          </button>
        </div>
        
        <div style="text-align: center; padding: 1.5rem; border: 1px solid var(--border-color); border-radius: var(--radius-sm);">
          <span style="font-size: 2rem; display: block; margin-bottom: 1rem;">ü§ñ</span>
          <h4 style="color: var(--primary-color); margin-bottom: 0.5rem;">AI Optimizer</h4>
          <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1rem;">
            Optimizaci√≥n autom√°tica con IA avanzada
          </p>
          <button onclick="addToCart('ai-optimizer', 'AI Optimizer', 99)" class="btn btn--secondary btn--small">
            Agregar - $99
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
let cart = JSON.parse(localStorage.getItem('plugandad_cart')) || [];

function loadCart() {
    const cartItemsContainer = document.getElementById('cart-items');
    const emptyCartDiv = document.getElementById('empty-cart');
    const recommendationsDiv = document.getElementById('recommendations');
    
    if (cart.length === 0) {
        cartItemsContainer.parentElement.parentElement.style.display = 'none';
        cartItemsContainer.parentElement.parentElement.nextElementSibling.style.display = 'none';
        emptyCartDiv.style.display = 'block';
        recommendationsDiv.style.display = 'none';
        return;
    }
    
    emptyCartDiv.style.display = 'none';
    recommendationsDiv.style.display = 'block';
    cartItemsContainer.parentElement.parentElement.style.display = 'block';
    cartItemsContainer.parentElement.parentElement.nextElementSibling.style.display = 'block';
    
    cartItemsContainer.innerHTML = '';
    
    cart.forEach((item, index) => {
        const itemDiv = document.createElement('div');
        itemDiv.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 1rem; border: 1px solid var(--border-color); border-radius: var(--radius-sm); margin-bottom: 1rem;';
        
        itemDiv.innerHTML = `
            <div>
                <h4 style="color: var(--text-dark); margin-bottom: 0.25rem;">${item.name}</h4>
                <p style="color: var(--text-muted); font-size: 0.875rem; margin: 0;">$${item.price} cada uno</p>
            </div>
            <div style="display: flex; align-items: center; gap: 1rem;">
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <button onclick="updateQuantity(${index}, -1)" style="background: var(--accent-color); border: none; border-radius: 50%; width: 32px; height: 32px; cursor: pointer;">-</button>
                    <span style="font-weight: 600; min-width: 20px; text-align: center;">${item.quantity}</span>
                    <button onclick="updateQuantity(${index}, 1)" style="background: var(--accent-color); border: none; border-radius: 50%; width: 32px; height: 32px; cursor: pointer;">+</button>
                </div>
                <span style="font-weight: 600; color: var(--primary-color); min-width: 60px;">$${item.price * item.quantity}</span>
                <button onclick="removeFromCart(${index})" style="background: #fee2e2; color: #dc2626; border: none; border-radius: var(--radius-sm); padding: 0.5rem; cursor: pointer;">üóëÔ∏è</button>
            </div>
        `;
        
        cartItemsContainer.appendChild(itemDiv);
    });
    
    updateTotals();
}

function updateQuantity(index, change) {
    cart[index].quantity += change;
    if (cart[index].quantity <= 0) {
        cart.splice(index, 1);
    }
    localStorage.setItem('plugandad_cart', JSON.stringify(cart));
    loadCart();
}

function removeFromCart(index) {
    cart.splice(index, 1);
    localStorage.setItem('plugandad_cart', JSON.stringify(cart));
    loadCart();
}

function updateTotals() {
    const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
    const itemCount = cart.reduce((total, item) => total + item.quantity, 0);
    const discount = itemCount >= 3 ? subtotal * 0.15 : 0;
    const total = subtotal - discount;
    
    document.getElementById('cart-subtotal').textContent = `$${subtotal}`;
    document.getElementById('cart-discount').textContent = `-$${discount.toFixed(0)}`;
    document.getElementById('cart-total').textContent = `$${total.toFixed(0)}`;
    
    const checkoutBtn = document.getElementById('checkout-btn');
    checkoutBtn.disabled = cart.length === 0;
    
    if (discount > 0) {
        document.getElementById('cart-discount').parentElement.style.display = 'flex';
    } else {
        document.getElementById('cart-discount').parentElement.style.display = 'none';
    }
}

function addToCart(id, name, price) {
    const existingItem = cart.find(item => item.id === id);
    
    if (existingItem) {
        existingItem.quantity += 1;
    } else {
        cart.push({
            id: id,
            name: name,
            price: price,
            quantity: 1
        });
    }
    
    localStorage.setItem('plugandad_cart', JSON.stringify(cart));
    loadCart();
}

document.addEventListener('DOMContentLoaded', function() {
    loadCart();
    
    document.getElementById('checkout-btn').addEventListener('click', function() {
        if (cart.length > 0) {
            alert('Funcionalidad de pago pr√≥ximamente. Los paquetes se configurar√°n autom√°ticamente en tu cuenta.');
            // Here you would integrate with a payment processor
            // cart = [];
            // localStorage.setItem('plugandad_cart', JSON.stringify(cart));
            // loadCart();
        }
    });
});
</script>
{% endblock %}